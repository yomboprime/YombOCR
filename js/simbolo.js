
var simbolos = [

    {
        cadena: "0",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 1, 1, 0,
            0, 1, 0, 0, 1, 0, 1, 0,
            0, 1, 0, 1, 0, 0, 1, 0,
            0, 1, 1, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "1",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 1, 1, 0, 0, 0,
            0, 0, 1, 0, 1, 0, 0, 0,
            0, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 1, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "2",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "3",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 0, 0, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "4",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 0, 1, 1, 0, 0, 0,
            0, 0, 1, 0, 1, 0, 0, 0,
            0, 1, 0, 0, 1, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "5",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "6",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "7",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 0, 0, 0, 0, 0, 1, 0,
            0, 0, 0, 0, 0, 1, 0, 0,
            0, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 0, 1, 0, 0, 0, 0,
            0, 0, 0, 1, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "8",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "9",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 1, 0,
            0, 0, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "A",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "B",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "C",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 0, 1, 1, 1, 1, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "D",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 0, 0, 0,
            0, 1, 0, 0, 0, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 0, 1, 0,
            0, 1, 0, 0, 0, 1, 0, 0,
            0, 1, 1, 1, 1, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "E",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    },
    {
        cadena: "F",
        pixels: [
            0, 0, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 1, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 1, 1, 1, 1, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 1, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0
        ]
    }
];

function reconocerSimbolo( pixels, tamX, caracter, pintarDebugCtxOverlay ) {

    // Rellena los valores del caracter con el simbolo encontrado

    var x0 = caracter.x0;
    var y0 = caracter.y0;
    var dx = caracter.x1 - x0  + 1;
    var dy = caracter.y1 - y0  + 1;

    var aspecto = dx / dy;
    var numPixelsX = 6;
    if ( aspecto < 5.1 / 6 ) {
        numPixelsX = 5;
    }
    var numPixelsY = 6;
    var numPixels = numPixelsX * numPixelsY;
    var tamPixelX = dx / numPixelsX;
    var tamPixelY = dy / numPixelsY;

    var maxAciertos = 0;
    var simboloSelec = -1;
    for ( var iSimbolo = 0, numSimbolos = simbolos.length; iSimbolo < numSimbolos; iSimbolo++ ) {

        var s = simbolos[ iSimbolo ];
        var sp = s.pixels;

        var numAciertos = 0;
        for ( var iy = 0; iy < numPixelsY; iy++ ) {
            var y = Math.floor( y0 + tamPixelY * ( iy + 0.5 ) );
            for ( var ix = 0; ix < numPixelsX; ix++ ) {
                var x = Math.floor( x0 + tamPixelX * ( ix + 0.5 ) );

                var p = y * tamX + x;

                var hayPixel = pixels[ p * 4 ] === 0;

                // Dibujado debug de deteccion
                if ( pintarDebugCtxOverlay ) {
                    if ( hayPixel ) {
                        pintarDebugCtxOverlay.strokeStyle = "magenta";
                    }
                    else {
                        pintarDebugCtxOverlay.strokeStyle = "cyan";
                    }
                    pintarDebugCtxOverlay.strokeRect( x, y, 0.5, 0.5 );
                }

                var debeHaberPixel = sp[ ( iy + 1 ) * 8 + ( ix + 1 + ( numPixelsX === 5 ? 1 : 0 ) ) ] === 1;
                if ( hayPixel === debeHaberPixel ) {
                    numAciertos++;
                }
            }
        }

        if ( simboloSelec === - 1 || numAciertos > maxAciertos ) {
            simboloSelec = iSimbolo;
            maxAciertos = numAciertos;
            if ( maxAciertos === numPixels ) {
                // Exito total
                break;
            }
        }

    }

    if ( maxAciertos >= ( ( 21 * numPixels ) / 36 ) ) {
        // Encontrado simbolo
        caracter.reconocido = true;
    }
    else {
        caracter.reconocido = false;
    }
    caracter.simbolo = simbolos[ simboloSelec ];
    caracter.aciertos = maxAciertos;

}